# 프로세스와 스레드

## 프로세스 (Process)
프로그램이 실행되고 있는 상태
- 프로그램: 어떤 작업을 하기 위해 실행할 수 있는 파일(컴퓨터가 특정 동작을 하기위해 작성된 실행 가능한 코드)

<br>

### 프로세스 메모리 구조
프로그램이 실행되어 프로세스가 만들어지면 다음 4가지의 메모리 영역으로 구성되어 할당 받게 된다.

- 코드(Code) 영역:

    코드 영역은 실행할 프로그램의 코드 및 매크로 상수가 기계어 형태로 저장되는 영역.
    <br>CPU는 코드영역에 저장된 명령어를 하나씩 처리한다.

- 데이터(Data) 영역:

    데이터 영역은 코드에서 선언한 전역 변수와 정적(static) 변수가 저장되는 영역.
    <br>데이터 영역은 프로그램의 시작과 함께 할당되어 종료될 때 소멸된다.

- 힙(Heap) 영역:

    힙 영역은 관리가 가능한 데이터 이외의 다른 형태의 데이터를 관리하기 위한 공간(Free Space).
    <br>이 공간은 동적 메모리 할당 공간이므로 사용이 끝나면 운영체제가 쓸수 있도록 반납해야 한다. 프로그램이 실행하는 순간 프로그램이 사용할 메모리 크기를 고려하여 메모리의 할당이 이루어지는 데이터 또는 스택과 같은 정적 메모리 할당과는 대조적이다. 동적 메모리 할당은 어느 시점에 어느 정도의 공간을 할당할 수 있을지 정확히게 예측할 수 없으므로, 런타임에 확인가능하다.

- 스택(Stack) 영역:

    스택 영역은 함수 안에서 선언된 지역변수, 매개변수, 리턴값 등이 저장되고, 함수 호출 시 기록하고 종료되면 제거하는 영역. 


### 프로세스 상태
<img width="600" alt="process" src="https://miro.medium.com/v2/resize:fit:1304/format:webp/0*g5eqOhLlurGLIz_3.jpg">

- new : 프로세스가 생성되는 상태
- ready : 프로세스가 CPU에 할당되어, 처리되기를 기다리는 상태
- running: 프로세스가 CPU에 할당되어, 명령어들이 실행 되는 상태
- waiting: 어떤 이벤트의 발생으로 인해 프로세스가 기다리는 상태
- terminated: 프로세스가 종료되는 상태

### PCB (Process Control Block)
운영체제에서 프로세스를 관리하기 위해 해당 프로세스의 상태 정보를 담고 있는 자료구조로 Context Switching 시 사용된다.
(CPU가 여러 프로세스를 빠르게 번갈아가면서 작업하기 위해서는 프로세스에 대한 정보 및 상태를 저장/복원 할 필요가 있다.)

- 포함 정보

    - 프로세스 식별자(Process ID)
    - 프로세스 상태(Process State): 생성(create), 준비(ready), 실행(running), 대기(waiting), 완료(terminated)
    - 프로그램 계수기(Program Counter): 프로그램 계수기는 이 프로세스가 다음에 실행할 명령어의 주소를 가리킨다.
    - CPU 레지스터 및 일반 레지스터
    - CPU 스케줄링 정보: 우선 순위, 최종 실행시각, CPU 점유시간 등
    - 메모리 관리 정보: 해당 프로세스의 주소 공간 등
    - 프로세스 계정 정보: 페이지 테이블, 스케줄링 큐 포인터, 소유자, 부모 등
    - 입출력 상태 정보: 프로세스에 할당된 입출력장치 목록, 열린 파일 목록 등


<br>

## 스레드 (Thread)
**프로세스 내**에서 실행되는 흐름의 단위
- 하나의 프로세스는 반드시 하나 이상의 스레드를 갖는다.
- `Stack` 영역만 별도로 할당 받고, 부모 프로세스의 Code, Data, Heap 영역은 공유

<img width="520" alt="메모리 관점에서 본 프로세스와 스레드" src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*39Jqwl1DcgCaTEGr.png">

<br>

## 컨텍스트 스위칭 (Context Switching)
하나의 작업이 CPU를 사용 중인 상태에서 다른 작업이 CPU를 사용하도록 전환하는 것

- CPU는 한 번에 한 가지 명령어만 처리 가능
- 운영체제의 CPU 자원을 할당하는 스케줄러(Scheuler)에 의해 발생

### 멀티태스킹 (Multitasking)
CPU가 작업하는데 필요한 자원(시간)을 프로세스 또는 스레드간에 나누는 행위

<img width="450" alt="프로세스" src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jvlxE7iwWWLvzxgo.png">

컴퓨터를 사용할 때 음악을 들으며 게임을 하고 메신저의 메시지를 확인할 수 있는 것은 멀티태스킹 덕분이다.
이것은 여러 작업이 동시에 실행되는 것처럼 느낄 수 있지만, CPU는 한 번에 한 가지 명령어밖에 처리하지 못한다.
엄청나게 빠르게 작업들을 번갈아 가며 실행하기 때문에 동시에 실행되는 것처럼 보이는 것이다.
이렇게 실행하는 작업을 바꾸는 동작을 **Context Switching**이라고 한다.

<br>

## 멀티 프로세스와 멀티 스레드
### 멀티 프로세스 (Multi Process)
하나의 애플리케이션을 여러 개의 프로세스로 구성하여 각 프로세스가 하나의 작업을 처리하도록 하는 것
- 구현이 비교적 간단하고, 각 프로세스들이 독립적으로 동작하며 자원의 서로 다르게 할당된다.
- 여러 개의 자식 프로세스 중 하나에 문제가 발생해도, 다른 자식 프로세스에 영향이 확산되지 않아 안정성이 좋다.

<img width="450" alt="멀티 프로세스" src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ckn6QtkZgOQ2m1xO.png">


### 멀티 스레드 (Multi Thread)
하나의 애플리케이션을 여러 개의 스레드로 구성하여 하나의 스레드가 하나의 작업을 처리하도록 하는 것
- 일반적인 사용하는 이유는 사용자와 상호작용하는 애플리케이션에서 단일 스레드로 Network나 DB와 관련 긴 작업을 수행하는 경우 해당 작업을 처리하는 동안 사용자와 상호작용이 불능인 상태가 될 수 있기 때문
- 자식 스레드 중 하나에 문제가 생긴경우 전체 프로세스에 영향을 줄 수 있다.
- 자원 공유가 쉽다. 스레드들은 부모 프로세스의 자원과 메모리를 공유 할 수 있다.
- 구현 및 테스트, 디버깅이 어렵다.

<img width="450" alt="멀티 스레드" src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Nkp_jRDjVXFjwlJ2.png">



<br><br>

#### Reference
- https://charlezz.medium.com/process%EC%99%80-thread-%EC%9D%B4%EC%95%BC%EA%B8%B0-5b96d0d43e37
- https://ko.wikipedia.org/wiki/%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4_%EC%A0%9C%EC%96%B4_%EB%B8%94%EB%A1%9D
- https://inpa.tistory.com/entry/%F0%9F%91%A9%E2%80%8D%F0%9F%92%BB-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4-%E2%9A%94%EF%B8%8F-%EC%93%B0%EB%A0%88%EB%93%9C-%EC%B0%A8%EC%9D%B4#pcb_process_control_block