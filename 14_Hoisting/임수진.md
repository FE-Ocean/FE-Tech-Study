# 호이스팅 (Hoisting)
자바스크립트 코드는 한 줄씩 순차적으로 실행된다.

- 예시 1.

    ```js
    console.log(hi);  //undefined

    var hi;
    ```
    위의 예시에서는 `hi` 변수의 선언이 이루어지기도 전에 콘솔에서 호출했다.
    <br>참조 에러가 발생할 것 같지만 `undefined`가 출력된다.


- 예시 2. 

    ```js
    console.log(callMyName('sujin'));  //Hello, sujin

    function callMyName(name) {
        return `Hello, ${name}`;
    }
    ```
    위의 예시에서는 함수 선언문 이전에 콘솔에서 호출했지만 잘 동작한다.

이와 같이 ***선언문이 코드의 선두로 끌어올려진 것처럼 동작하는 자바스크립트 고유의 특징***을 호이스팅이라 한다.

<br><br>

## 소스코드 평가와 실행
자바스크립트 엔진은 소스코드를 '소스코드의 평가’와 ‘소스코드의 실행’으로 나누어 처리한다.
1. 평가 과정
- 실행 컨텍스트 생성
- 변수, 함수 등의 선언문만 먼저 실행
        
    → 실행하여 생성된 변수나 함수 식별자를 키로, 실행 컨텍스트가 관리하는 스코프(렉시컬 환경의 환경 레코드)에 등록

2. 실행 과정
- 이미 실행된 선언문을 제외한 코드가 한 줄씩 순차적으로 실행(런타임 시작)
- 소스코드 실행에 필요한 정보, 변수나 함수의 참조를 실행 컨텍스트가 관리하는 스코프에서 검색해서 취득
- 변수 값의 변경 등 소스코드의 실행 결과는 다시 실행 컨텍스트가 관리하는 스코프에 등록

<br><br>

## 변수 호이스팅
변수 선언문이 코드의 선두로 끌어올려진 것처럼 동작하는 자바스크립트 고유의 특징을 변수 호이스팅이라 한다.

### var
```js
    console.log(hi);  //undefined

    var hi;
    console.log(hi);  //undefined

    hi = 22;
    console.log(hi);  //22
```
위의 코드는 소스코드 평가와 실행 부분에서 나와 있듯이 아래의 과정을 거친다.

- (소스코드 평가 과정) 1 - 3
1. 소스코드의 평가 과정에서 `var hi;` 코드가 먼저 실행된다.
2. 스코프(실행 컨텍스트의 렉시컬 환경)에 변수를 등록해 자바스크립트 엔진에 변수의 존재를 알린다.
3. 그리고 즉시 `undefined`로 변수를 초기화한다.

**선언과 초기화가 코드 실행 전 평가 과정에서 먼저 이루어지기 때문에 선언하기 전에 변수에 접근해도 에러가 발생하지 않는다.**

- (소스코드 실행 과정) 4 - 5

4. `var hi;`를 제외한 코드들이 한 줄씩 순차적으로 실행된다.
5. 먼저 `console.log` 두 개가 실행되어 undefined를 출력하고, 
<br>`hi = 22;`에 도달해 `hi`에 22가 할당된다. 
6. 이제 `hi`에 값이 할당되었기 때문에 세 번째 `console.log`에서는 22가 출력된다.
<br>


- **선언만 호이스팅 대상이다.**

    ```js
    console.log(num);  //ReferenceError
    num = 6;  // 초기화
    ```
    자바스크립트는 초기화를 제외한 *선언만 호이스팅*한다.
    <br>위 예제는 선언 없이 초기화만 존재한다. 그래서 호이스팅도 없고, 변수를 읽으려는 시도에서는 ReferenceError 에러가 발생한다.

<br>

### let, const
```js
console.log(foo);  //ReferenceError: foo is not defined

let foo;
```
변수 선언문 이전에 참조하니 참조 에러가 발생한다.
<br>`var` 키워드로 선언한 변수와 달리 *`let` 키워드로 선언한 변수는 변수 호이스팅이 발생하지 않는 것처럼 동작한다.*<br>

```js
console.log(foo);  //ReferenceError: foo is not defined

let foo;  // 변수 선언문에서 초기화 단계가 실행된다.
console.log(foo);  //undefined

foo = 1;  // 할당문에서 할당 단계가 실행된다.
console.log(foo);  //1
```
- let 키워드로 선언한 변수는 **‘선언 단계’와 ‘초기화 단계’가 분리되어 진행**된다.

    `var`의 경우에는 소스코드 평가 과정에서 스코프에 변수를 등록하고 undefined로 초기화 하지만,
    <br>`let`은 변수 선언문에 도달했을 때 초기화가 된다.
- let 키워드로 선언한 변수는 **스코프의 시작 지점부터 초기화 단계 시작 지점(변수 선언문)까지 변수를 참조할 수 없다.**

    위 예제의 첫 번째 콘솔은 초기화 단계가 실행되기 이전에 변수를 참조해서 참조 에러가 발생했다. 
    <br>스코프의 시작 시점부터 초기화 시작 지점까지 변수를 참조할 수 없는 구간을 **일시적 사각지대**라고 부른다.

### 🔖 일시적 사각지대 (Temporal Dead Zone; TDZ)
`let` 또는 `const`로 선언할 경우 스코프의 시작 시점(변수 선언문)부터 초기화 시작 지점까지 변수를 참조할 수 없는 구간

<br><br>

## 함수 호이스팅
**함수 선언문**이 코드의 선두로 끌어 올려진 것처럼 동작하는 자바스크립트 고유의 특징을 함수 호이스팅이라 한다.
```js
// 함수 참조
console.dir(add);  //f add(x, y)
console.dir(sub);  //undefined

// 함수 호출
console.log(add(2, 5));  //7
console.log(sub(2, 5));  //TypeError: sub is not a function

// 함수 선언문
function add(x, y) {
    return x + y;
}

// 함수 표현식
var sub = function (x, y) {
    return x - y;
}
```
- **함수 선언문으로 정의한 함수와 함수 표현식으로 정의한 함수의 생성 시점은 다르다.**

    위 예제와 같이 함수 선언문으로 정의한 함수는 함수 선언문 이전에 호출할 수 있다. 그러나 함수 표현식으로 정의한 함수는 함수 표현식 이전에 호출할 수 없다.

### 함수 선언문
- 함수 선언문으로 정의한 함수를 **함수 선언문 이전에 참조, 호출하면 함수 호이스팅에 의해 참조, 호출이 가능** (선언문이 어디에 위치하든 호출 가능)

    함수 선언문 역시 런타임(소스 코드 실행 과정)전 소스 코드 평가 과정에서 먼저 실행된다.
    <br>실행되어 스코프에 함수를 등록하고, **함수 객체**로 초기화된다.
    <br>그리고 함수 이름과 동일한 이름의 식별자를 암묵적으로 생성하고 생성된 함수 객체를 할당한다.
- **함수 선언문이 코드의 선두로 끌어 올려진 것처럼 동작하는 자바스크립트 고유의 특징을 함수 호이스팅이라 한다.**

<br>

### 함수 표현식
- `var` 키워드로 정의한 함수 표현식을 함수 표현식 이전에
<br>*참조*하면 undefined로 평가, *호출*하면 타입 에러 발생

    undefined를 호출하는 것과 같기에 타입 에러 발생
- 함수 표현식으로 함수를 정의하면 함수 호이스팅이 발생하는 것이 아니라 **변수 호이스팅이 발생**

    변수를 선언하고 변수에 함수 리터럴을 할당하는 것이 함수 표현식이다.
    <br>그래서 변수 선언문과 변수 할당문을 한 번에 적은 것과 동일하게 동작한다.
    <br>그래서 *변수 선언문*은 소스코드 평가 과정에서 실행되어 undefined로 초기화되지만
    <br>*변수 할당문*은 런타임(소스코드 실행 과정)에 실행되어 평가되므로 그때 **함수 객체**가 된다.

<br><br>

> **모든 선언문은 런타임 이전 단계(소스코드 평가 과정)에서 먼저 실행되기 때문에
<br>`var`, `let`, `const`, `function`, `function*`, `class` 키워드를 사용해서 선언하는 모든 식별자(변수, 함수, 클래스 등)는 호이스팅된다.**

<br><br>

#### Reference
- 책 <모던 자바스크립트 Deep Dive>
- https://developer.mozilla.org/ko/docs/Glossary/Hoisting
