## 1. 이벤트 루프
자바스크립트는 싱글 스레드 런타임을 제공한다. 이는 한번에 하나의 태스크만 처리할 수 있다는 것이다. 
만약 하나의 태스크가 오래 걸리는 비동기 작업일 경우 다른 작업들이 실행되지 못하고 대기해야하는 일이 발생할 것이다. 
자바스크립트는 이러한 문제를 **브라우저가 제공하는 웹 api와 이벤트 루프를 통해 비동기 작업을 처리하고, 호출 스택 상태에 따라 작업을 조정하여 동시성을 제공함으로써 해결**한다. <br/>

이벤트 루프는 콜 스택에 현재 실행 중인 실행 컨텍스트 있는지, 그리고 태스크 큐에 대기중인 함수가 있는지 반복해서 확인한다. 
만약 콜스택이 비어있고 태스크큐에 대기중인 함수가 있다면 이벤트 루프는 순차적으로 태스크큐에 대기중인 함수를 콜스택으로 이동시킨다. 
이때 콜 스택으로 이동한 함수는 실행된다. 즉 태스크큐에 일시 보관된 함수들은 비동기 처리 방식으로 동작한다.

<br/>

<image src="https://velog.velcdn.com/images/miniso/post/629ff7c2-33cf-4bb1-a146-f8354230190a/image.gif">

<br/>

## 2. 태스크큐 
- 자바스크립트 실행환경에서 비동기 작업을 처리하기 위해 사용
- 비동기 작업이 완료되거나 이벤트가 발생할 때 해당 작업을 순서대로 저장하고 관리
- setTimeout, setInterval 같은 비동기 함수의 콜백 함수 또는 이벤트 핸들러가 일시적으로 보관되는 영역
- 이벤트 루프에 의해 모니터링 되며 콜스택이 비어있을 경우 태스크 큐에 있는 작업을 차례로 이동시켜 실행

<br/>

### 2-1. 매크로 태스크큐
- setTimeout, setInterval에 의해 예약된 작업
- ajax 요청 (XMLHttpRequest, fetch)
- DOM 이벤트 처리
- 네트워크 요청 등

<br/>

### 2-2. 마이크로 태스크큐
- 프로미스의 후속 처리 메서드의 콜백 함수(.then/catch/finally)가 일시적으로 보관되는 큐.
- 콜백함수나 이벤트 핸들러를 일시 저장한다는 점에서 매크로 태스크큐와 동일하지만 마이크로 태스크큐는 매크로 태스크큐보다 우선순위가 높다.
- 비동기 작업의 결과 처리 및 UI 업데이트와 같이 중요한 작업들을 빠르게 처리하기 위해 사용한다.
- 이벤트 루프는 콜스택이 비면 먼저 마이크로 태스크큐에서 대기하고 있는 함수를 가져와 실행한다. 
- 마이크로 태스크큐가 비면 태스크큐에서 대기하고 있는 함수를 가져와 실행한다. 

<br/>
<br/>

## 3. 예시 코드 
```js
console.log('Start');

setTimeout(function () {
  console.log('setTimeout');
}, 0);

Promise.resolve().then(function () {
  console.log('Promise');
});

console.log('End');

// 결과값
// Start
// End
// Promise
// setTimeout
```
1. `console.log('Start')` 콜스택에 쌓이자마자 **Start 출력**
2. `setTimeout`을 설정하여 타이머 시작, 해당 작업은 웹 api에서 처리되며 타이머가 완료되면 **매크로 태스크큐**에 해당 작업 추가.
3. `Promise.resolve().then` 호출되고 프로미스가 완료되면 해당 작업이 **마이크로 태스크큐**에 추가
4. `console.log('End')` 콜스택에 쌓이자마자 **End 출력**
5. 콜스택이 비었기 때문에 이벤트루프는 태스크큐를 확인,<br/>
이때 마이크로 태스크큐 우선적으로 처리. 마이크로 태스크큐에 작업이 콜스택으로 이동 후 실행 → **Promise 출력**
6. 콜스택이 다시 비었기 때문에 이벤트루프는 태스크큐를 확인, <br/>
마이크로 태스크큐가 비어있기 때문에 매크로 태스크큐에 있는 작업이 콜스택으로 이동 후 실행 → **SetTimeout 출력**

<br/>
<hr/>
<br/>

### [참고자료]
JSConf EU https://www.youtube.com/watch?v=8aGhZQkoFbQ <br/>
MDN https://developer.mozilla.org/ko/docs/Web/JavaScript/Event_loop <br/>
자바스크립트 딥다이브