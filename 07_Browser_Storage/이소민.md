## HTTP (HyperText Transfer Protocol)
- 인터넷에서 클라이언트와 서버간 통신을 위한 프로토콜
- HTTP는 클라이언트가 서버에게 request를 보내고,<br/>
서버가 클라이언트에게 request에 대한 response를 보낸 뒤 **접속을 종료(비연결성)** 
- 통신이 끝나면 **상태(ex.인증에 쓰이는 상태) 정보를 유지하지 않음(무상태성)**

<br/>

#### * connectionless (비연결성)
- 요청을 주고 받을 때만 연결을 유지하고 응답 주고 나면 TCP/IP 연결을 끊음
- 최소한의 자원으로 서버 유지 가능

<br/>

#### * stateless (무상태성)
- 통신이 끝나면 서버가 클라이언트의 상태를 보존하지 않음
- 서버가 별도의 추가 정보를 관리하지 않아도 되기 때문에 다수의 요청 처리 및 서버의 부하를 줄일 수 있음

<br/>

HTTP의 이러한 특성으로 통신할 때마다 새로 연결해야하기 때문에 클라이언트는 그 때마다 인증해야 함. <br/>
가령 웹사이트에 로그인을 해두어도 페이지 이동할 때마다 로그인을 새로 해주어야한다는 것을 의미. <br/>
→ **브라우저 저장소**에 데이터를 저장해둠으로써 보완할 수 있음.

<br/>
<hr/>
<br/>

## 쿠키
- 서버가 클라이언트에게 전송하는 작은 데이터 파일
- 이름, 값, 도메인 정보, 경로 정보, 만료 일자와 시간 등의 정보가 담겨 있음
- 만료 기간 지정 가능
- 기간을 설정해야하거나 자동으로 서버로 전송되어야 하는 작은 용량의 데이터 경우에 사용<br/>
(ex. n일 동안 보지 않기, 비로그인 장바구니)

<br/>

### 동작 원리
```
1. 클라이언트가 페이지를 요청
2. 서버에서 쿠키 생성
3. HTTP 헤더에 쿠키를 포함시켜 응답 (같은 도메인에서 만들어진 쿠키만)
4. 쿠키 만료 기간 있다면 브라우저가 종료되어도 클라이언트에서 보관
5. 클라이언트가 쿠키 보관하고 있다가 다시 서버에 요청할 때 HTTP 헤더에 쿠키 전송
```

```js
document.cookie = "user=John; path=/; expires=Tue, 19 Jan 2038 03:14:07 GMT"
```
### 쿠키의 옵션
- path
    - 해당 경로나 해당 경로의 하위 경로에 있는 페이지만 쿠키에 접근 가능 
- domain
    - 쿠키에 접근 가능한 도메인 지정
    - 옵션에 아무 값도 넣지 않았다면 쿠키 설정한 도메인에서만 접근 가능
- expires & max-age
    - 설정된 유효일자 도달하면 쿠키 자동으로 삭제 
    - 옵션값을 0 이나 음수로 설정하면 쿠키 바로 삭제
    - 반드시 GMT 포맷으로 설정
    - 영구쿠키 (만료기간 o, 만료기간 끝난 후 삭제)
    - 세션쿠키 (만료기간 x, 브라우저 종료 시 삭제)
- secure
    - secure 옵션 설정된 경우 HTTPS 통신시에만 접근할 수 있음
- samesite
    - 크로스 사이트 요청 위조 공격(cross-site request forgery, CSRF) 막기 위해 만들어진 옵션
    - samesite = strict
    - samesite = lax

<br/>

###  같은 도메인 다른 도메인?
- First party Cookie 
    - 같은 도메인에서 생성된 쿠키
    - 서브 도메인인 경우도 포함
- Third party Cookie 
    - 다른 도메인에서 생성된 쿠키
    - A사이트에 Z사이트 스크립트 존재할 때 Third party Cookie 생성
    - 스크립트 뿐만 아니라 이미지, 폰트, iframe 등 다른 도메인으로 요청해야하는 경우 생성
    - 사용자의 방문 사이트를 파악하기 때문에 주로 광고 목적으로 사용

<br/>

### 쿠키의 단점
- 보안에 취약 → 민감한 정보는 저장하지 않는 것이 좋음 
    - CSRF : 사용자의 권한을 이용한 공격(ex. 비밀번호 변경, 결제 요청 등)
    - XSS : 사용자의 민감한 정보 탈취 (ex. 토큰)
- 부족한 저장 용량(4kb)
- 매번 요청마다 서버로 전송, 불필요한 트래픽 증가

<br/>
<br/>

### 쿠키 보안 문제 해결 방안
|  | 해결 방안 | 이유 |
| --- | --- | --- |
| XSS | HttpOnly | 해당 옵션 설정하면 자바스크립트로 접근 불가하기 때문 ||
| CSRF | SameSite <br/> strict : 모두 허용하지 않음 <br/>lax : 안전한 GET 요청만 허용(a tag) | 같은 도메인의 요청에만 쿠키를 전송 <br/>크롬은 기본적으로 lax 옵션 설정되어 있음 |
|  | Referer 검증 | 요청 온 사이트의 도메인을 확인할 수 있음 |

<br/>
<br/>

## 웹 스토리지
- HTML5부터는 쿠키의 단점을 보완해 등장한 웹 스토리지를 주로 사용
- 웹 스토리지 객체는 네트워크 요청시 서버로 전송되지 않음
- key, value의 형태로 데이터 저장
- 지속성에 따라 로컬 스토리지와 세션 스토리지로 구분
- 로컬 스토리지는 브라우저를 종료했을 때도 유지되어야할 때<br/>
(ex. 사용자 설정 저장, 글 임시 저장, 자동 로그인)
- 세션 스토리지는 탭 종료시 삭제되어도 괜찮은 데이터의 경우에 사용<br/>
(ex. 이전 페이지 저장, 이전 스크롤 위치 저장, 입력 폼 정보)

<br/>

|  | 로컬 스토리지  | 세션 스토리지  |
| --- | --- | --- |
| 저장 범위 | 도메인 / 브라우저 | 도메인 / 브라우저 / 탭 |
| 삭제 시기  | 직접 삭제 시  | 탭 종료 시  |

<br/>

### 특징
- HTML5 지원하는 웹 브라우저 경우 대략 5MB 저장 용량 (쿠키의 4kb 저장 용량 단점 보완)
- 요청시 Headers에 전송하지 않음 (쿠키의 CSRF, 트래픽 문제 해결)
- 문자열만 저장 가능 (직렬화를 통해 객체 저장 가능)

<br/>

### 주의할 점 
- 브라우저 버전에 따라 웹스토리지를 지원하지 않을 수 있음
- 웹 스토리지 비활성화할 수 있는 기능을 제공하는 브라우저 존재하기 때문에 에러가 발생할 수 있음<br/>(사파리의 시크릿모드 접속시 스토리지 할당량이 0으로 설정되기 때문에 할당량 초과 에러 발생)<br/>
→ 웹 스토리지를 사용할 땐 에러 처리 필요

<br/>

### 단점
- 보안에 취약 → 민감한 정보는 저장하지 않는 것이 좋음 
    - XSS : 자바스크립트로 접근 가능
- 브라우저/탭(세션 스토리지) 간 공유 불가
- 만료 기간 설정 불가
- 동기적으로 실행되기 때문에 메인 스레드를 블로킹함, 따라서 큰 데이터 다룰 때 주의해야함.
<br/> (용량이 큰 경우 indexedDB를 고려할 필요 있음)

<br/>
<br/>
<br/>

### 웹스토리지 보안 문제 해결 방안

|  | 해결 방안 | 이유 |
| --- | --- | --- |
| XSS | innerHTML 사용 X <br/>사용자의 입력이 자바스크립트 코드로 실행될 수 있는 코드 작성하지 않기  | 자바스크립트 코드 삽입 불가<br/>(innerHTML 사용해야한다면 XSS 보안 라이브러리 sanitize-html, DOMPurify 사용) |

<br/>
<br/>

## [ 참고자료 ]
https://ko.javascript.info/cookie <br/>
https://ko.javascript.info/localstorage <br/>
https://www.youtube.com/watch?v=-4ZsGy1LOiE <br/>